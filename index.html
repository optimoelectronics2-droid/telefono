<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Trifusion Technologies ‚Äî Cat√°logo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    :root{
        --bg:#0b0f19;
        --card:#101624;
        --card-border:#1f2940;
        --accent:#00c2ff;
        --accent-soft:rgba(0,194,255,0.18);
        --text:#e6ecff;
        --muted:#9aa4c6;
        --danger:#ff4b6a;
    }

    body {
        font-family: system-ui, Arial, sans-serif;
        background: radial-gradient(circle at top, #172239 0, #050712 55%, #02030a 100%);
        margin: 0;
        color: var(--text);
    }

    header {
        padding: 18px 16px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        background: rgba(0,0,0,0.6);
        backdrop-filter: blur(10px);
        position: sticky;
        top: 0;
        z-index: 50;
    }

    .header-inner{
        max-width: 1100px;
        margin: 0 auto;
        display:flex;
        justify-content: space-between;
        align-items:center;
    }

    .logo-title h1{
        margin:0;
        font-size:22px;
        letter-spacing:0.03em;
    }

    .header-contact{
        font-size:12px;
        color: var(--muted);
        text-align:right;
    }

    /* Toolbar */
    .toolbar{
        max-width:1100px;
        margin:18px auto 0;
        padding:0 16px 4px;
        display:grid;
        grid-template-columns:minmax(0,2fr) minmax(0,1fr);
        gap:12px;
    }

    @media(max-width:800px){
        .toolbar{
            grid-template-columns:1fr;
        }
    }

    .panel{
        background:rgba(8,12,26,0.9);
        border-radius:14px;
        padding:10px;
        border:1px solid rgba(255,255,255,0.05);
    }

    .panel-title{
        font-size:13px;
        margin-bottom:6px;
        color:var(--muted);
        text-transform:uppercase;
        letter-spacing:0.1em;
    }

    input[type="text"], input[type="number"]{
        width:100%;
        background:#050815;
        border-radius:10px;
        border:1px solid rgba(255,255,255,0.08);
        padding:8px 10px;
        color:var(--text);
        font-size:14px;
        outline:none;
    }

    button{
        border:none;
        border-radius:10px;
        padding:8px 15px;
        font-size:14px;
        font-weight:600;
        letter-spacing:0.03em;
        cursor:pointer;
        background:linear-gradient(135deg,var(--accent),#62e3ff);
        color:#02030a;
        box-shadow:0 6px 18px rgba(0,194,255,0.35);
        white-space:nowrap;
    }

    /* Cat√°logo */
    .catalogo-wrapper{
        max-width:1100px;
        margin:20px auto 40px;
        padding:0 16px;
    }

    .catalogo{
        display:flex;
        flex-direction:column;
        gap:12px;
    }

    .producto{
        background:var(--card);
        border-radius:14px;
        padding:14px;
        border:1px solid var(--card-border);
        box-shadow:0 14px 30px rgba(0,0,0,0.35);
        display:flex;
        justify-content:space-between;
        align-items:flex-start;
        gap:15px;
    }

    .descripcion{
        font-size:16px;
        color:var(--accent);
        font-weight:600;
        word-break:break-word;
        flex:1;
    }

    .producto-right{
        display:flex;
        flex-direction:column;
        align-items:flex-end;
        min-width:160px;
        gap:6px;
    }

    .precio{
        font-size:20px;
        font-weight:700;
        white-space:nowrap;
        color:var(--danger);
    }

    .precio.transito{
        color:#ffc14b;
        text-shadow:0 0 6px rgba(255,193,75,0.45);
    }

    .editor-precio{
        display:flex;
        gap:6px;
        align-items:center;
    }

    .editor-precio label{
        display:none;
    }

    #mensajeVacio{
        text-align:center;
        margin-top:15px;
        color:var(--muted);
    }
</style>
</head>
<body>

<header>
    <div class="header-inner">
        <div class="logo-title">
            <h1>Trifusion Technologies</h1>
        </div>
        <div class="header-contact">
            üìç Santo Domingo<br>
            WhatsApp: +1 (829) 872-5163
        </div>
    </div>
</header>

<!-- TOOLBAR -->
<div class="toolbar">

    <!-- Buscador -->
    <div class="panel">
        <div class="panel-title">Buscar art√≠culos</div>
        <input id="buscadorProductos" type="text" placeholder="Escribe el modelo o parte del nombre...">
    </div>

    <!-- Acceso admin (solo muestra ENTRAR) -->
    <div class="panel">
        <div class="panel-title">Acceso</div>
        <button id="btnLogin">Entrar</button>
        <button id="btnLogout" style="display:none;">Salir</button>
    </div>

</div>

<!-- CAT√ÅLOGO -->
<div class="catalogo-wrapper">
    <div id="catalogo" class="catalogo"></div>
    <div id="mensajeVacio" style="display:none;">No se encontraron productos.</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
// =========================
// CONFIG PRIVADA DEL C√ìDIGO
// =========================
const ADMIN_USER = "TELEFONO";
const ADMIN_PASS = "1234"; // contrase√±a
const SHEET_ID = "1EtOwxNRGq0WFgGaRXtJgibUqzxIgcAUeRkJlr1wPsLc";

let esAdmin = false;
let productos = [];
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;

function formatearPrecio(num){
    return "$" + num.toLocaleString("es-DO");
}

function cargarLista(data){
    productos = [];

    data.forEach(fila=>{
        const desc = (fila[2]||"").trim();
        const precioRaw = (fila[3]||"").trim();
        if (!desc || !precioRaw) return;

        let esTransito = false;
        let base = null;

        if (precioRaw.toUpperCase().includes("TRANSITO")) {
            esTransito = true;
        } else {
            let soloNum = precioRaw.replace(/[^0-9]/g,"");
            base = parseFloat(soloNum) || null;
        }

        productos.push({
            descripcion: desc,
            basePrecio: base,
            esTransito
        });
    });
}

function renderProductos(filtro=""){
    const cont = document.getElementById("catalogo");
    const vacio = document.getElementById("mensajeVacio");

    cont.innerHTML = "";
    const f = filtro.trim().toLowerCase();

    const lista = productos.filter(p=>!f || p.descripcion.toLowerCase().includes(f));

    vacio.style.display = lista.length === 0 ? "block" : "none";

    lista.forEach((p,idx)=>{
        let final = "";
        let clase = "";

        if(p.esTransito){
            final = "TR√ÅNSITO";
            clase = "transito";
        } else if(p.basePrecio){
            final = formatearPrecio(Math.round(p.basePrecio*1.20));
        } else {
            final = "SIN PRECIO";
            clase = "transito";
        }

        const card = document.createElement("div");
        card.className = "producto";

        // EDITOR SOLO SI ADMIN
        const editor = esAdmin && !p.esTransito ? `
            <div class="editor-precio">
                <input type="number" value="${p.basePrecio||""}" min="0" data-idx="${idx}" class="input-precio">
                <button data-idx="${idx}" class="btn-aplicar">OK</button>
            </div>
        ` : "";

        card.innerHTML = `
            <div class="descripcion">${p.descripcion}</div>
            <div class="producto-right">
                <div class="precio ${clase}">${final}</div>
                ${editor}
            </div>
        `;

        cont.appendChild(card);
    });
}

async function cargarCatalogo(){
    const resp = await fetch(CSV_URL);
    const csv = await resp.text();
    Papa.parse(csv,{
        header:false,
        skipEmptyLines:true,
        complete:(res)=>{
            cargarLista(res.data);
            renderProductos();
        }
    });
}

// Buscar
document.getElementById("buscadorProductos").addEventListener("input", e=>{
    renderProductos(e.target.value);
});

// Login
document.getElementById("btnLogin").addEventListener("click", ()=>{
    const u = prompt("Usuario:");
    if(!u) return;
    const p = prompt("Contrase√±a:");

    if(u===ADMIN_USER && p===ADMIN_PASS){
        esAdmin = true;
        document.getElementById("btnLogout").style.display="inline-block";
        alert("Modo edici√≥n activado");
        renderProductos(document.getElementById("buscadorProductos").value);
    } else {
        alert("Acceso denegado");
    }
});

// Logout
document.getElementById("btnLogout").addEventListener("click", ()=>{
    esAdmin = false;
    document.getElementById("btnLogout").style.display="none";
    renderProductos(document.getElementById("buscadorProductos").value);
});

// Guardar precio
document.getElementById("catalogo").addEventListener("click", e=>{
    if(e.target.classList.contains("btn-aplicar")){
        const idx = e.target.dataset.idx;
        const input = document.querySelector(`.input-precio[data-idx="${idx}"]`);
        const val = parseFloat(input.value);
        if(!val){ alert("Precio inv√°lido"); return;}
        productos[idx].basePrecio = val;
        renderProductos(document.getElementById("buscadorProductos").value);
    }
});

cargarCatalogo();
</script>

</body>
</html>
