<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cat√°logo ‚Äî Trifusion Technologies</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    :root{
        --bg:#0b0f19;
        --card:#101624;
        --card-border:#1f2940;
        --accent:#00c2ff;
        --accent-soft:rgba(0,194,255,0.18);
        --text:#e6ecff;
        --muted:#9aa4c6;
        --danger:#ff4b6a;
    }

    body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #172239 0, #050712 55%, #02030a 100%);
        margin: 0;
        color: var(--text);
    }

    header {
        padding: 18px 16px;
        border-bottom: 1px solid rgba(255,255,255,0.06);
        backdrop-filter: blur(16px);
        background: linear-gradient(120deg, rgba(0,0,0,0.4), rgba(9,15,32,0.95));
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .header-inner{
        max-width: 1100px;
        margin: 0 auto;
        display:flex;
        justify-content: space-between;
        align-items: center;
        gap:12px;
    }

    .logo-title{
        display:flex;
        flex-direction:column;
        gap:4px;
    }

    .logo-title h1 {
        margin: 0;
        font-size: 22px;
        letter-spacing: 0.04em;
        text-transform: uppercase;
    }

    .logo-title span{
        font-size: 12px;
        color: var(--muted);
    }

    .header-contact{
        text-align:right;
        font-size:12px;
        color:var(--muted);
    }

    .header-contact strong{
        color:var(--accent);
    }

    /* Toolbar */

    .toolbar{
        max-width:1100px;
        margin:18px auto 0;
        padding:0 16px 4px;
        display:grid;
        grid-template-columns: minmax(0,2fr) minmax(0,1.5fr);
        gap:12px;
    }

    @media (max-width:780px){
        .toolbar{
            grid-template-columns: minmax(0,1fr);
        }
        .header-inner{
            flex-direction:column;
            align-items:flex-start;
        }
        .header-contact{
            text-align:left;
        }
    }

    .panel{
        background:rgba(8,12,26,0.9);
        border-radius:14px;
        padding:10px 12px 12px;
        border:1px solid rgba(255,255,255,0.06);
        box-shadow:0 14px 40px rgba(0,0,0,0.45);
    }

    .panel-title{
        font-size:13px;
        text-transform:uppercase;
        letter-spacing:0.12em;
        color:var(--muted);
        margin-bottom:8px;
    }

    .field-row{
        display:flex;
        gap:8px;
        align-items:center;
    }

    .field-row input[type="text"]{
        flex:1;
    }

    input[type="text"], input[type="number"]{
        background:#050815;
        border-radius:10px;
        border:1px solid rgba(255,255,255,0.08);
        padding:8px 10px;
        color:var(--text);
        font-size:14px;
        outline:none;
    }

    input[type="text"]:focus,
    input[type="number"]:focus{
        border-color:var(--accent);
        box-shadow:0 0 0 1px rgba(0,194,255,0.4);
    }

    button{
        border:none;
        border-radius:999px;
        padding:8px 14px;
        font-size:13px;
        font-weight:600;
        letter-spacing:0.04em;
        text-transform:uppercase;
        cursor:pointer;
        background:linear-gradient(135deg,var(--accent),#4df1ff);
        color:#02030a;
        box-shadow:0 8px 22px rgba(0,194,255,0.35);
        display:inline-flex;
        align-items:center;
        gap:6px;
        white-space:nowrap;
    }

    button.secondary{
        background:transparent;
        color:var(--accent);
        border:1px solid rgba(0,194,255,0.6);
        box-shadow:none;
    }

    .admin-status{
        margin-top:6px;
        font-size:12px;
        color:var(--muted);
    }

    .admin-status span.on{
        color:#4cff9a;
    }
    .admin-status span.off{
        color:var(--danger);
    }

    /* Catalog */

    .catalogo-wrapper{
        max-width:1100px;
        margin:8px auto 30px;
        padding:0 16px 20px;
    }

    .catalogo{
        display:flex;
        flex-direction:column;
        gap:12px;
        margin-top:10px;
    }

    .producto{
        position:relative;
        background: radial-gradient(circle at top left, rgba(0,194,255,0.18), transparent 55%),
                    radial-gradient(circle at bottom right, rgba(76,255,154,0.09), transparent 50%),
                    var(--card);
        border-radius:16px;
        padding:14px 16px;
        border:1px solid var(--card-border);
        box-shadow:0 18px 40px rgba(0,0,0,0.6);
        display:flex;
        justify-content:space-between;
        align-items:flex-start;
        gap:16px;
        overflow:hidden;
    }

    .producto::before{
        content:"";
        position:absolute;
        inset:0;
        border-radius:16px;
        border:1px solid rgba(255,255,255,0.04);
        pointer-events:none;
        mix-blend-mode:screen;
    }

    .producto-left{
        flex:1;
        min-width:0;
    }

    .descripcion{
        font-size:16px;
        color:var(--accent);
        font-weight:600;
        white-space:normal;
        word-break:break-word;
        margin-bottom:4px;
    }

    .meta{
        font-size:12px;
        color:var(--muted);
    }

    .producto-right{
        display:flex;
        flex-direction:column;
        align-items:flex-end;
        gap:6px;
        min-width:170px;
    }

    .precio{
        font-size:20px;
        font-weight:700;
        color:var(--danger);
        white-space:nowrap;
        text-shadow:0 0 10px rgba(255,75,106,0.45);
    }

    .precio.transito{
        color:#ffc14b;
        text-shadow:0 0 10px rgba(255,193,75,0.45);
    }

    .precio-base{
        font-size:12px;
        color:var(--muted);
    }

    .editor-precio{
        display:flex;
        gap:6px;
        align-items:center;
        margin-top:4px;
    }

    .editor-precio label{
        font-size:11px;
        color:var(--muted);
    }

    .editor-precio input[type="number"]{
        width:90px;
        font-size:13px;
        padding-inline:6px;
    }

    .badge-admin{
        font-size:10px;
        padding:2px 6px;
        border-radius:999px;
        border:1px solid rgba(0,194,255,0.7);
        color:var(--accent);
        text-transform:uppercase;
        letter-spacing:0.08em;
    }

    .empty{
        text-align:center;
        margin-top:20px;
        color:var(--muted);
        font-size:14px;
    }

    /* Panel im√°genes */

    .imagenes-panel{
        max-width:1100px;
        margin:0 auto 40px;
        padding:0 16px 20px;
    }

    .iframe-box{
        margin-top:10px;
        background:rgba(4,7,18,0.95);
        border-radius:14px;
        border:1px solid rgba(255,255,255,0.06);
        overflow:hidden;
    }

    .iframe-box iframe{
        width:100%;
        height:360px;
        border:none;
        background:#000;
    }

    .links-busqueda{
        display:flex;
        flex-wrap:wrap;
        gap:8px;
        margin-top:8px;
        font-size:12px;
    }

    .links-busqueda a{
        color:var(--accent);
        text-decoration:none;
        padding:4px 10px;
        border-radius:999px;
        border:1px solid rgba(0,194,255,0.5);
    }

    .links-busqueda a:hover{
        background:var(--accent-soft);
    }
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo-title">
      <h1>Trifusion Technologies</h1>
      <span>Cat√°logo din√°mico y accesorios</span>
    </div>
    <div class="header-contact">
      üìç Santo Domingo<br>
      WhatsApp: <strong>+1 (829) 872-5163</strong>
    </div>
  </div>
</header>

<!-- TOOLBAR SUPERIOR -->
<div class="toolbar">
  <!-- Buscador de productos -->
  <div class="panel">
    <div class="panel-title">Buscador de productos</div>
    <div class="field-row">
      <input id="buscadorProductos" type="text" placeholder="Escribe parte del nombre o descripci√≥n...">
      <button id="btnLimpiarBusqueda" class="secondary">Limpiar</button>
    </div>
  </div>

  <!-- Login admin TELEFONO -->
  <div class="panel">
    <div class="panel-title">Modo edici√≥n de precios</div>
    <div class="field-row">
      <button id="btnLogin">Entrar</button>
      <button id="btnLogout" class="secondary">Salir</button>
    </div>
    <div class="admin-status">
      Estado: <span id="estadoAdmin" class="off">Solo lectura</span>
      <div style="margin-top:4px;">Usuario permitido: <strong>TRIFUSION</strong> (configurado en el c√≥digo)</div>
    </div>
  </div>
</div>

<!-- CAT√ÅLOGO -->
<div class="catalogo-wrapper">
  <div id="catalogo" class="catalogo"></div>
  <div id="mensajeVacio" class="empty" style="display:none;">No se encontraron art√≠culos para ese filtro.</div>
</div>

<!-- PANEL IM√ÅGENES / P√ÅGINA OFICIAL -->
<div class="imagenes-panel">
  <div class="panel">
    <div class="panel-title">Buscar im√°genes y p√°gina oficial del art√≠culo</div>
    <div class="field-row" style="margin-bottom:6px;">
      <input id="buscadorImagenes" type="text" placeholder="Ej: GALAXY A17 256GB">
      <button id="btnBuscarImagenes">Buscar</button>
    </div>
    <div class="links-busqueda">
      <a id="linkGoogleImagenes" href="#" target="_blank" rel="noopener">Ver im√°genes en Google</a>
      <a id="linkGoogleWeb" href="#" target="_blank" rel="noopener">Buscar p√°gina oficial / web</a>
    </div>
    <div class="iframe-box">
      <!-- OJO: Google puede bloquear el iframe, pero el link siempre funciona -->
      <iframe id="iframeImagenes" src="about:blank"></iframe>
    </div>
  </div>
</div>

<!-- PapaParse -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
const SHEET_ID = "1EtOwxNRGq0WFgGaRXtJgibUqzxIgcAUeRkJlr1wPsLc";
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;

// Usuario admin
const ADMIN_USER = "TELEFONO";
const ADMIN_PASS = "1234"; // c√°mbialo si quieres

let esAdmin = false;
let productos = []; // { descripcion, basePrecio, esTransito }

function formatearPrecio(num) {
    return "$" + num.toLocaleString("es-DO");
}

function construirProductos(data){
    productos = [];
    data.forEach(fila => {
        const desc = (fila[2] || "").toString().trim(); // C
        const precioRaw = (fila[3] || "").toString().trim(); // D

        // ignorar filas sin descripci√≥n
        if (!desc) return;

        let esTransito = false;
        let base = null;

        if (!precioRaw) {
            // sin precio -> lo ignoramos como art√≠culo
            return;
        }

        const upper = precioRaw.toUpperCase();

        if (upper.includes("TRANSITO") || upper.includes("TR√ÅNSITO")) {
            esTransito = true;
        } else {
            let soloNumeros = precioRaw.replace(/[^0-9]/g, "");
            if (soloNumeros) {
                base = parseFloat(soloNumeros);
                if (isNaN(base)) base = null;
            }
        }

        productos.push({
            descripcion: desc,
            basePrecio: base,
            esTransito
        });
    });
}

function renderProductos(filtroTexto = ""){
    const contenedor = document.getElementById("catalogo");
    const msgVacio = document.getElementById("mensajeVacio");
    contenedor.innerHTML = "";

    const texto = filtroTexto.trim().toLowerCase();

    const lista = productos.filter(p =>
        !texto || p.descripcion.toLowerCase().includes(texto)
    );

    if (lista.length === 0){
        msgVacio.style.display = "block";
        return;
    } else {
        msgVacio.style.display = "none";
    }

    lista.forEach((p, idx) => {
        let etiquetaPrecio = "";
        let clasePrecio = "";
        let detalleBase = "";

        if (p.esTransito){
            etiquetaPrecio = "TR√ÅNSITO";
            clasePrecio = "transito";
        } else if (p.basePrecio && !isNaN(p.basePrecio)) {
            const finalCon20 = Math.round(p.basePrecio * 1.20);
            etiquetaPrecio = formatearPrecio(finalCon20);
            detalleBase = "Base: " + formatearPrecio(p.basePrecio);
        } else {
            etiquetaPrecio = "PRECIO";
            clasePrecio = "transito";
        }

        const editorHTML = (esAdmin && !p.esTransito) ? `
            <div class="editor-precio">
                <label>Base RD$:</label>
                <input type="number" min="0" step="1" value="${p.basePrecio || ""}" data-idx="${idx}" class="input-precio">
                <button type="button" class="btn-guardar" data-idx="${idx}">Aplicar</button>
            </div>
        ` : "";

        const badge = esAdmin ? `<div class="badge-admin">Edici√≥n activa</div>` : "";

        const card = document.createElement("div");
        card.className = "producto";
        card.innerHTML = `
            <div class="producto-left">
                <div class="descripcion">${p.descripcion}</div>
                <div class="meta">${detalleBase}</div>
            </div>
            <div class="producto-right">
                ${badge}
                <div class="precio ${clasePrecio}">${etiquetaPrecio}</div>
                ${editorHTML}
            </div>
        `;
        contenedor.appendChild(card);
    });
}

async function cargarCatalogo(){
    const resp = await fetch(CSV_URL);
    const csv = await resp.text();
    Papa.parse(csv, {
        header:false,
        skipEmptyLines:true,
        complete: function(res){
            construirProductos(res.data);
            renderProductos();
        }
    });
}

// Buscador de productos
document.getElementById("buscadorProductos").addEventListener("input", (e)=>{
    renderProductos(e.target.value);
});
document.getElementById("btnLimpiarBusqueda").addEventListener("click", ()=>{
    const inp = document.getElementById("buscadorProductos");
    inp.value = "";
    renderProductos("");
});

// Login / logout admin
function actualizarEstadoAdmin(){
    const span = document.getElementById("estadoAdmin");
    if (esAdmin){
        span.textContent = "Modo edici√≥n activo";
        span.className = "on";
    } else {
        span.textContent = "Solo lectura";
        span.className = "off";
    }
    renderProductos(document.getElementById("buscadorProductos").value);
}

document.getElementById("btnLogin").addEventListener("click", ()=>{
    const user = prompt("Usuario:");
    if (!user) return;
    const pass = prompt("Contrase√±a (configurada en el c√≥digo):");
    if (user === ADMIN_USER && pass === ADMIN_PASS){
        esAdmin = true;
        actualizarEstadoAdmin();
        alert("Sesi√≥n iniciada como TELEFONO. Ahora puedes editar precios base.");
    } else {
        alert("Credenciales incorrectas.");
    }
});

document.getElementById("btnLogout").addEventListener("click", ()=>{
    esAdmin = false;
    actualizarEstadoAdmin();
});

// Delegar eventos para guardar precios editados
document.getElementById("catalogo").addEventListener("click", (e)=>{
    if (e.target.classList.contains("btn-guardar")){
        const idx = parseInt(e.target.dataset.idx,10);
        const input = document.querySelector(`.input-precio[data-idx="${idx}"]`);
        if (!input) return;
        const value = parseFloat(input.value);
        if (isNaN(value) || value <= 0){
            alert("Introduce un precio base v√°lido.");
            return;
        }
        productos[idx].basePrecio = value;
        renderProductos(document.getElementById("buscadorProductos").value);
    }
});

// Buscador de im√°genes / p√°gina oficial
document.getElementById("btnBuscarImagenes").addEventListener("click", ()=>{
    const q = document.getElementById("buscadorImagenes").value.trim();
    if (!q) return;
    const encoded = encodeURIComponent(q);

    const urlImgs = `https://www.google.com/search?tbm=isch&q=${encoded}`;
    const urlWeb  = `https://www.google.com/search?q=${encoded}`;

    document.getElementById("linkGoogleImagenes").href = urlImgs;
    document.getElementById("linkGoogleWeb").href = urlWeb;

    // Intento de previsualizar im√°genes dentro de la p√°gina.
    // Nota: Google a veces bloquea iframes; si no carga, usa los links de arriba.
    document.getElementById("iframeImagenes").src = urlImgs;
});

// Cargar datos al inicio
cargarCatalogo();
actualizarEstadoAdmin();
</script>

</body>
</html>
